"use strict";(self.webpackChunkrinconada=self.webpackChunkrinconada||[]).push([[871],{42871:function(e,a,t){t.r(a),t.d(a,{default:function(){return N}});var n=t(4942),r=t(74165),o=t(1413),i=t(15861),l=t(29439),s=t(97892),u=t.n(s),c=t(72791),d=t(38411),f=(t(71368),t(53939)),p=t(99763),v=(t(64941),t(83188)),h=t(4808),Z=t(28181),m=t(87309),x=t(49389),b=t(80184),g=x.Z.Search,j=function(e){var a=e.setFilterText,t=e.setModal;return(0,b.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,b.jsx)("div",{style:{width:"300px"},children:(0,b.jsx)(g,{placeholder:"Ingresa un termino aqui...",onChange:function(e){return a(e.target.value)}})}),(0,b.jsx)("div",{children:(0,b.jsx)(m.ZP,{onClick:function(){t(!0)},style:{width:"150px"},children:"Pago Multiple"})})]})},q=t(93433),y=t(17615),w=t(53655),_=t(77128),C=t(83099),F=t(80458),S=t(58848),T=t(68588),k=t(36473),D=t(78792),M=t(66106),Y=t(30914),E=t(2964),L=t(35790),I=t(16026),P=t(69967),z=t(78820);var V=function(e){var a=e.open,t=e.setModal,s=e.trabajadores,f=e.actualizarTabla,v=e.closeModalSubmit,h=void 0===v?function(){}:v,Z=e.dataToEdit,g=e.setDataToEdit,j=void 0===g?function(){}:g,V=y.Z.useForm(),N=(0,l.Z)(V,1)[0],O=w.Z.Text,A=(0,c.useContext)(d.s),R=A.updateData,J=A.createData,K=A.cargando,X=A.setCargando,B=null===s||void 0===s?void 0:s.map((function(e){return{value:e.id,label:e.nombre}})),G=function(){t(!1)},H=(0,c.useState)([]),Q=(0,l.Z)(H,2),U=Q[0],W=Q[1],$=(0,c.useState)([]),ee=(0,l.Z)($,2),ae=ee[0],te=ee[1];(0,c.useEffect)((function(){if(U.length>0){var e=s.filter((function(e){return U.includes(e.id)}));te(e)}}),[U]);var ne=(0,c.useState)(I.XK),re=(0,l.Z)(ne,2),oe=re[0],ie=re[1],le=function(e,a){if(!a&&e.target){var t=e.target,r=t.name,i=t.value;N.setFieldsValue((0,n.Z)({},r,i)),ie((function(e){return(0,o.Z)((0,o.Z)({},e),{},(0,n.Z)({},r,i))}))}else N.setFieldsValue((0,n.Z)({},a,e)),ie((function(t){return(0,o.Z)((0,o.Z)({},t),{},(0,n.Z)({},a,e))}))},se=(0,c.useState)([]),ue=(0,l.Z)(se,2),ce=ue[0],de=ue[1];(0,c.useEffect)((function(){if(ae.length>0){var e=ae.map((function(e){return{id:e.id,nombre:e.nombre,contrato_id:e.contrato_id,teletrans:e.teletrans||"",trabajador_dni:e.dni,quincena:e.quincena,saldoFinal:e.saldoFinal}}));de(Z?oe.trabajadores.map((function(e){return(0,o.Z)((0,o.Z)({},e),{},{teletrans:parseFloat(e.teletrans)})})):e)}}),[ae]);var fe=function(){var e=0;return ce.forEach((function(a){e=parseFloat(e)+parseFloat(a.teletrans)})),e},pe=function(){var e=(0,i.Z)((0,r.Z)().mark((function e(){var a,t,n,o,i,l;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a="pago/programacion/multiple",t={observacion:oe.observacion,fecha_pago:u()(oe.fecha_pago).format("YYYY-MM-DD")||"",teletrans:fe(),tipo:"pago",trabajadores:ce.map((function(e){return{contrato_id:e.contrato_id,volquetes:e.voqluetes,teletrans:e.teletrans,quincena:e.quincena,trabajador_dni:e.trabajador_dni,saldoFinal:e.saldoFinal}}))},n=!0,o=0,t.trabajadores.forEach((function(e){var a=Number(e.teletrans)||0;a>(Number(e.saldoFinal)||0)&&(n=!1),o+=a})),n){e.next=8;break}return(0,p.q)(500,"El pago a uno de los trabajadores es mayor a lo adeudado"),e.abrupt("return");case 8:if(4===o){e.next=11;break}return(0,p.q)(500,"La cantidad de teletrans debe ser equivalente a un volquete."),e.abrupt("return");case 11:if(!Z){e.next=19;break}return X(!0),e.next=15,R(t,oe.pago_id,"pago/multiple");case 15:(i=e.sent)&&((0,p.q)(i.status,i.msg),f(),ve()),e.next=23;break;case 19:return e.next=21,J(t,a);case 21:(l=e.sent)&&((0,p.q)(l.status,l.msg),f(),ve());case 23:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,c.useEffect)((function(){Z&&(ie((0,o.Z)((0,o.Z)({},Z),{},{fecha_pago:u()(Z.fecha_pago).format("YYYY-MM-DD")})),W(Z.trabajadores.map((function(e){return e.id}))),de(Z.trabajadores))}),[Z]);var ve=function(){j(null),G(),h()};return(0,b.jsx)(P.Z,{open:a,closeModal:Z?ve:G,title:"Juntar Teletrans",width:800,children:(0,b.jsxs)(y.Z,{form:N,className:"modal-body",onFinish:pe,layout:"vertical",children:[(0,b.jsx)(_.Z,{orientation:"left",children:"Datos"}),(0,b.jsxs)(C.Z,{direction:"vertical",style:{width:"100%"},children:[(0,b.jsx)(y.Z.Item,{label:"Seleccione trabajadores",children:(0,b.jsx)(F.Z,{showSearch:!0,mode:"multiple",placeholder:"Seleccione trabajadores",style:{width:"100%"},allowClear:!0,value:U,onChange:function(e){W(e)},options:B,disabled:!!Z,filterOption:function(e,a){return a.label.toLowerCase().indexOf(e.toLowerCase())>=0}})}),(0,b.jsx)(y.Z.Item,{label:"Observaci\xf3n",children:(0,b.jsx)(x.Z,{name:"observacion",value:oe.observacion,placeholder:"Observaci\xf3n",onChange:function(e){return le(e)}})}),(0,b.jsx)(y.Z.Item,{label:"Fecha",children:(0,b.jsx)(S.ZP,{locale:L.Z,children:(0,b.jsx)(T.Z,{allowClear:!1,value:u()(oe.fecha_pago),name:"fecha_pago",placeholder:"Fecha de Pago",picker:"day",onChange:function(e){return le(e,"fecha_pago")},style:{width:"100%"},format:"YYYY-MM-DD"})})})]}),(0,b.jsx)(_.Z,{orientation:"left",children:"Trabajadores"}),(0,b.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:4},children:(0,b.jsxs)(k.Z,{style:{width:"100%"},children:[(0,b.jsx)(D.ZP,{itemLayout:"horizontal",dataSource:ce,renderItem:function(e){return(0,b.jsx)(D.ZP.Item,{children:(0,b.jsxs)(M.Z,{style:{width:"100%"},children:[(0,b.jsx)(Y.Z,{span:18,children:(0,b.jsx)(C.Z,{direction:"vertical",children:e.nombre})}),(0,b.jsx)(Y.Z,{span:6,children:(0,b.jsx)(C.Z,{direction:"vertical",children:(0,b.jsx)(x.Z,{value:e.teletrans,placeholder:"Teletrans",type:"number",min:0,onChange:function(a){return function(e,a){var t=ce.findIndex((function(e){return e.id===a}));ce[t]=(0,o.Z)((0,o.Z)({},ce[t]),{},{teletrans:parseFloat(e.target.value)}),de((0,q.Z)(ce))}(a,e.id)},required:!0})})})]},e.id)})}}),(0,b.jsxs)(C.Z,{direction:"horizontal",style:{width:"100%",justifyContent:"end",alignItems:"center",padding:24},children:[(0,b.jsx)(O,{type:fe()%4===0?"success":"danger",children:"TOTAL DE TELETRANS"}),(0,b.jsx)(E.Z,{message:fe(),type:fe()%4===0?"success":"error"})]})]})}),(0,b.jsxs)(C.Z,{direction:"horizontal",style:{width:"100%",marginTop:20,justifyContent:"end"},children:[(0,b.jsx)(m.ZP,{onClick:G,children:"Cancelar"}),(0,b.jsx)(m.ZP,{type:"primary",htmlType:"submit",icon:(0,b.jsx)(z.lFz,{}),loading:!!K,disabled:0===ce.length,children:"Registrar"})]})]})})},N=function(){var e=(0,c.useContext)(d.s),a=e.getData,t=e.createData,s=(0,c.useState)([]),m=(0,l.Z)(s,2),x=m[0],g=m[1],q=(0,c.useState)(!1),y=(0,l.Z)(q,2),w=y[0],_=y[1],C=(0,c.useState)(!1),F=(0,l.Z)(C,2),S=F[0],T=F[1],k=(0,c.useState)(""),D=(0,l.Z)(k,2),M=D[0],Y=D[1],E=(0,c.useState)(!1),L=(0,l.Z)(E,2),I=(L[0],L[1]),P=(0,c.useState)([]),z=(0,l.Z)(P,2),N=(z[0],z[1],(0,c.useState)("")),O=(0,l.Z)(N,2),A=O[0],R=O[1],J=(0,c.useState)([]),K=(0,l.Z)(J,2),X=K[0],B=K[1],G=(0,c.useState)([]),H=(0,l.Z)(G,2),Q=H[0],U=H[1],W=function(){var e=(0,i.Z)((0,r.Z)().mark((function e(){var t,n,i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a("programacion");case 2:(t=e.sent)&&(n=t.data.filter((function(e){return null!==e})),g(n),i=n.map((function(e){return(0,o.Z)((0,o.Z)({},e),{},{initialTeletrans:e.teletrans,initialVolquetes:e.volquetes,fecha_pago:u()(new Date).format("YYYY-MM-DD")})})),g(i));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,c.useEffect)((function(){W()}),[]);var $=function(){var e=(0,i.Z)((0,r.Z)().mark((function e(a){var n,o,i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n={observacion:a.observacion,fecha_pago:a.fecha_pago,volquetes:a.initialVolquetes,teletrans:a.initialTeletrans,tipo:"pago",trabajadores:[{volquetes:a.initialVolquetes,teletrans:a.initialTeletrans,contrato_id:a.contrato_id,trabajador_dni:a.dni,quincena:a.quincena}]},!((o=4*parseFloat(a.initialVolquetes||0)+parseFloat(a.initialTeletrans||0))>a.saldo)){e.next=6;break}(0,p.q)(500,"El monto a pagar es mayor a lo adeudado."),e.next=14;break;case 6:if(o%4===0){e.next=10;break}(0,p.q)(500,"La cantidad debe ser equivalente a un volquete."),e.next=14;break;case 10:return e.next=12,t(n,"pago/programacion/multiple");case 12:(i=e.sent)&&((0,p.q)(i.status,i.msg),W());case 14:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}();(0,c.useEffect)((function(){var e=x&&x.filter((function(e){var a,t,n,r;return(null===e||void 0===e||null===(a=e.nombre)||void 0===a||null===(t=a.toLowerCase())||void 0===t?void 0:t.includes(A.toLowerCase()))||(null===e||void 0===e||null===(n=e.cargo)||void 0===n||null===(r=n.toLowerCase())||void 0===r?void 0:r.includes(A.toLowerCase()))}));B(e)}),[A,x]);var ee=(0,f.lF)((function(e,a,t){if(e.target){var r=e.target,i=r.name,l=r.value;g((function(e){return e.map((function(e,r){var s,u,c,d;return r===t?(0,o.Z)((0,o.Z)({},e),{},(d={},(0,n.Z)(d,i,l),(0,n.Z)(d,"contrato_id",null===a||void 0===a?void 0:a.contrato_id),(0,n.Z)(d,"id",(null===a||void 0===a||null===(s=a.pagos)||void 0===s||null===(u=s.pagos)||void 0===u||null===(c=u.at(-1))||void 0===c?void 0:c.id)||""),d)):e}))}))}else g((function(n){return n.map((function(n,r){var i,l,s;return r===t?(0,o.Z)((0,o.Z)({},n),{},{observacion:e,contrato_id:null===a||void 0===a?void 0:a.contrato_id,id:(null===a||void 0===a||null===(i=a.pagos)||void 0===i||null===(l=i.pagos)||void 0===l||null===(s=l.at(-1))||void 0===s?void 0:s.id)||""}):n}))}))}),$,(function(e){T(!0),Y(e.observaciones)}));return(0,c.useEffect)((function(){var e=x.map((function(e){return{id:e.id,contrato_id:e.contrato_id,dni:e.dni,nombre:e.nombre+" - "+e.quincena,quincena:e.quincena,saldoFinal:e.saldoFinal}}));e.length>0&&U(e)}),[x]),(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(v.Z,{text:"Programaci\xf3n de pagos",ruta:"/planilla"}),(0,b.jsxs)("div",{className:"margenes",children:[(0,b.jsx)(j,{setModal:_,setFilterText:R}),(0,b.jsx)(h.Z,{columns:ee,table:X})]}),w&&(0,b.jsx)(V,{open:w,setModal:_,closeModal:function(){I(!1)},actualizarTabla:W,trabajadores:Q}),S&&(0,b.jsx)(Z.Z,{modal:S,setModal:T,observacion:M,boton:!1})]})}}}]);
//# sourceMappingURL=871.30f566cf.chunk.js.map