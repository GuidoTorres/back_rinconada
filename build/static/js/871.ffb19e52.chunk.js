"use strict";(self.webpackChunkrinconada=self.webpackChunkrinconada||[]).push([[871],{28181:function(e,n,t){var a=t(74165),r=t(15861),o=t(29439),i=t(49389),s=t(87309),l=t(72791),c=t(38411),u=t(99763),d=t(69967),f=t(80184);n.Z=function(e){var n=e.modal,t=e.setModal,p=(e.getPlanilla,e.data),v=e.observacion,h=e.boton,Z=(0,l.useContext)(c.s).updateData,g=(0,l.useState)(""),m=(0,o.Z)(g,2),x=m[0],b=m[1],j=function(){t(!1)},y=function(){var e=(0,r.Z)((0,a.Z)().mark((function e(){var n,t;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={observaciones:x},e.next=3,Z(n,p.aprobacion_id,"aprobacion/observacion");case 3:(t=e.sent)&&((0,u.q)(t.status,t.msg),j());case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return console.log("===================================="),console.log(p),console.log("===================================="),(0,f.jsxs)(d.Z,{className:"modal-usuario",title:h?"Agregar Observaci\xf3n":"Observaci\xf3n RRHH",open:n,width:400,closeModal:j,children:[(0,f.jsx)(i.Z.TextArea,{showCount:!0,maxLength:255,defaultValue:p.observaciones?p.observaciones:v||"",style:{height:120,marginBottom:24,marginTop:15},onChange:function(e){b(e.target.value)},placeholder:"Observaci\xf3n"}),(0,f.jsx)("div",{style:{width:"100%",display:"flex",justifyContent:"flex-end",paddingTop:"10px"},children:h&&(0,f.jsx)(s.ZP,{onClick:y,children:"Guardar"})})]})}},42871:function(e,n,t){t.r(n),t.d(n,{default:function(){return z}});var a=t(4942),r=t(74165),o=t(1413),i=t(15861),s=t(29439),l=t(97892),c=t.n(l),u=t(72791),d=t(38411),f=(t(71368),t(53939)),p=t(99763),v=(t(64941),t(83188)),h=t(4808),Z=t(28181),g=t(87309),m=t(49389),x=t(80184),b=m.Z.Search,j=function(e){var n=e.setFilterText,t=e.setModal;return(0,x.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,x.jsx)("div",{style:{width:"300px"},children:(0,x.jsx)(b,{placeholder:"Ingresa un termino aqui...",onChange:function(e){return n(e.target.value)}})}),(0,x.jsx)("div",{children:(0,x.jsx)(g.ZP,{onClick:function(){t(!0)},style:{width:"150px"},children:"Pago Multiple"})})]})},y=t(93433),w=t(17615),C=t(53655),q=t(77128),_=t(83099),T=t(80458),S=t(58848),M=t(68588),D=t(36473),Y=t(78792),F=t(66106),k=t(30914),E=t(2964),P=t(35790),L=t(16026),I=t(69967),O=t(78820);var V=function(e){var n=e.open,t=e.setModal,l=e.trabajadores,f=e.actualizarTabla,v=e.closeModalSubmit,h=void 0===v?function(){}:v,Z=e.dataToEdit,b=e.setDataToEdit,j=void 0===b?function(){}:b,V=w.Z.useForm(),z=(0,s.Z)(V,1)[0],A=C.Z.Text,N=(0,u.useContext)(d.s),R=N.updateData,H=N.createData,B=N.cargando,G=N.setCargando,J=null===l||void 0===l?void 0:l.map((function(e){return{value:e.id,label:e.nombre}})),K=function(){t(!1)},X=(0,u.useState)([]),Q=(0,s.Z)(X,2),U=Q[0],W=Q[1],$=(0,u.useState)([]),ee=(0,s.Z)($,2),ne=ee[0],te=ee[1];(0,u.useEffect)((function(){if(U.length>0){var e=l.filter((function(e){return U.includes(e.id)}));te(e)}}),[U]);var ae=(0,u.useState)(L.XK),re=(0,s.Z)(ae,2),oe=re[0],ie=re[1],se=function(e,n){if(!n&&e.target){var t=e.target,r=t.name,i=t.value;z.setFieldsValue((0,a.Z)({},r,i)),ie((function(e){return(0,o.Z)((0,o.Z)({},e),{},(0,a.Z)({},r,i))}))}else z.setFieldsValue((0,a.Z)({},n,e)),ie((function(t){return(0,o.Z)((0,o.Z)({},t),{},(0,a.Z)({},n,e))}))},le=(0,u.useState)([]),ce=(0,s.Z)(le,2),ue=ce[0],de=ce[1];(0,u.useEffect)((function(){if(ne.length>0){var e=ne.map((function(e){return{id:e.id,nombre:e.nombre,contrato_id:e.contrato_id,teletrans:e.teletrans||"",trabajador_dni:e.dni,quincena:e.quincena}}));de(Z?oe.trabajadores.map((function(e){return(0,o.Z)((0,o.Z)({},e),{},{teletrans:parseFloat(e.teletrans)})})):e)}}),[ne]);var fe=function(){var e=0;return ue.forEach((function(n){e=parseFloat(e)+parseFloat(n.teletrans)})),e},pe=function(){var e=(0,i.Z)((0,r.Z)().mark((function e(){var n,t,a,o;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n="pago/programacion/multiple",G(!0),t={observacion:oe.observacion,fecha_pago:c()(oe.fecha_pago).format("YYYY-MM-DD")||"",teletrans:fe(),tipo:"pago",trabajadores:ue.map((function(e){return{contrato_id:e.contrato_id,volquetes:e.voqluetes,teletrans:e.teletrans,quincena:e.quincena,trabajador_dni:e.trabajador_dni}}))},!Z){e.next=10;break}return e.next=6,R(t,oe.pago_id,"pago/multiple");case 6:(a=e.sent)&&((0,p.q)(a.status,a.msg),f(),ve()),e.next=14;break;case 10:return e.next=12,H(t,n);case 12:(o=e.sent)&&((0,p.q)(o.status,o.msg),f(),ve());case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,u.useEffect)((function(){Z&&(ie((0,o.Z)((0,o.Z)({},Z),{},{fecha_pago:c()(Z.fecha_pago).format("YYYY-MM-DD")})),W(Z.trabajadores.map((function(e){return e.id}))),de(Z.trabajadores))}),[Z]);var ve=function(){j(null),K(),h()};return(0,x.jsx)(I.Z,{open:n,closeModal:Z?ve:K,title:"Juntar Teletrans",width:800,children:(0,x.jsxs)(w.Z,{form:z,className:"modal-body",onFinish:pe,layout:"vertical",children:[(0,x.jsx)(q.Z,{orientation:"left",children:"Datos"}),(0,x.jsxs)(_.Z,{direction:"vertical",style:{width:"100%"},children:[(0,x.jsx)(w.Z.Item,{label:"Seleccione trabajadores",children:(0,x.jsx)(T.Z,{showSearch:!0,mode:"multiple",placeholder:"Seleccione trabajadores",style:{width:"100%"},allowClear:!0,value:U,onChange:function(e){W(e)},options:J,disabled:!!Z,filterOption:function(e,n){return n.label.toLowerCase().indexOf(e.toLowerCase())>=0}})}),(0,x.jsx)(w.Z.Item,{label:"Observaci\xf3n",children:(0,x.jsx)(m.Z,{name:"observacion",value:oe.observacion,placeholder:"Observaci\xf3n",onChange:function(e){return se(e)}})}),(0,x.jsx)(w.Z.Item,{label:"Fecha",children:(0,x.jsx)(S.ZP,{locale:P.Z,children:(0,x.jsx)(M.Z,{allowClear:!1,value:c()(oe.fecha_pago),name:"fecha_pago",placeholder:"Fecha de Pago",picker:"day",onChange:function(e){return se(e,"fecha_pago")},style:{width:"100%"},format:"YYYY-MM-DD"})})})]}),(0,x.jsx)(q.Z,{orientation:"left",children:"Trabajadores"}),(0,x.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:4},children:(0,x.jsxs)(D.Z,{style:{width:"100%"},children:[(0,x.jsx)(Y.ZP,{itemLayout:"horizontal",dataSource:ue,renderItem:function(e){return(0,x.jsx)(Y.ZP.Item,{children:(0,x.jsxs)(F.Z,{style:{width:"100%"},children:[(0,x.jsx)(k.Z,{span:18,children:(0,x.jsx)(_.Z,{direction:"vertical",children:e.nombre})}),(0,x.jsx)(k.Z,{span:6,children:(0,x.jsx)(_.Z,{direction:"vertical",children:(0,x.jsx)(m.Z,{value:e.teletrans,placeholder:"Teletrans",type:"number",min:0,onChange:function(n){return function(e,n){var t=ue.findIndex((function(e){return e.id===n}));ue[t]=(0,o.Z)((0,o.Z)({},ue[t]),{},{teletrans:parseFloat(e.target.value)}),de((0,y.Z)(ue))}(n,e.id)},required:!0})})})]},e.id)})}}),(0,x.jsxs)(_.Z,{direction:"horizontal",style:{width:"100%",justifyContent:"end",alignItems:"center",padding:24},children:[(0,x.jsx)(A,{type:fe()%4===0?"success":"danger",children:"TOTAL DE TELETRANS"}),(0,x.jsx)(E.Z,{message:fe(),type:fe()%4===0?"success":"error"})]})]})}),(0,x.jsxs)(_.Z,{direction:"horizontal",style:{width:"100%",marginTop:20,justifyContent:"end"},children:[(0,x.jsx)(g.ZP,{onClick:K,children:"Cancelar"}),(0,x.jsx)(g.ZP,{type:"primary",htmlType:"submit",icon:(0,x.jsx)(O.lFz,{}),loading:!!B,disabled:0===ue.length,children:"Registrar"})]})]})})},z=function(){var e=(0,u.useContext)(d.s),n=e.getData,t=e.createData,l=(0,u.useState)([]),g=(0,s.Z)(l,2),m=g[0],b=g[1],y=(0,u.useState)(!1),w=(0,s.Z)(y,2),C=w[0],q=w[1],_=(0,u.useState)(!1),T=(0,s.Z)(_,2),S=T[0],M=T[1],D=(0,u.useState)(""),Y=(0,s.Z)(D,2),F=Y[0],k=Y[1],E=(0,u.useState)(!1),P=(0,s.Z)(E,2),L=(P[0],P[1]),I=(0,u.useState)([]),O=(0,s.Z)(I,2),z=(O[0],O[1],(0,u.useState)("")),A=(0,s.Z)(z,2),N=A[0],R=A[1],H=(0,u.useState)([]),B=(0,s.Z)(H,2),G=B[0],J=B[1],K=(0,u.useState)([]),X=(0,s.Z)(K,2),Q=X[0],U=X[1],W=function(){var e=(0,i.Z)((0,r.Z)().mark((function e(){var t,a,i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n("programacion");case 2:(t=e.sent)&&(a=t.data.filter((function(e){return null!==e})),b(a),i=a.map((function(e){return(0,o.Z)((0,o.Z)({},e),{},{initialTeletrans:e.teletrans,initialVolquetes:e.volquetes,fecha_pago:c()(new Date).format("YYYY-MM-DD")})})),b(i));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,u.useEffect)((function(){W()}),[]);console.log(m);var $=function(){var e=(0,i.Z)((0,r.Z)().mark((function e(n){var a,o,i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={observacion:n.observacion,fecha_pago:n.fecha_pago,volquetes:n.initialVolquetes,teletrans:n.initialTeletrans,tipo:"pago",trabajadores:[{volquetes:n.initialVolquetes,teletrans:n.initialTeletrans,contrato_id:n.contrato_id,trabajador_dni:n.dni,quincena:n.quincena}]},(o=4*n.initialVolquetes+n.initialTeletrans)>n.saldo?(0,p.q)(500,"El monto a pagar es mayor a lo adeudado."):o%4===0&&(0,p.q)(500,"Error! solo se puede pagar un cantidad equivalente a un volquete."),e.next=5,t(a,"pago/programacion/multiple");case 5:(i=e.sent)&&((0,p.q)(i.status,i.msg),W());case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();(0,u.useEffect)((function(){var e=m&&m.filter((function(e){var n,t,a,r;return(null===e||void 0===e||null===(n=e.nombre)||void 0===n||null===(t=n.toLowerCase())||void 0===t?void 0:t.includes(N.toLowerCase()))||(null===e||void 0===e||null===(a=e.cargo)||void 0===a||null===(r=a.toLowerCase())||void 0===r?void 0:r.includes(N.toLowerCase()))}));J(e)}),[N,m]);var ee=(0,f.lF)((function(e,n,t){if(console.log("===================================="),console.log(e),console.log("===================================="),e.target){var r=e.target,i=r.name,s=r.value;b((function(e){return e.map((function(e,r){var l,c,u,d;return r===t?(0,o.Z)((0,o.Z)({},e),{},(d={},(0,a.Z)(d,i,s),(0,a.Z)(d,"contrato_id",null===n||void 0===n?void 0:n.contrato_id),(0,a.Z)(d,"id",(null===n||void 0===n||null===(l=n.pagos)||void 0===l||null===(c=l.pagos)||void 0===c||null===(u=c.at(-1))||void 0===u?void 0:u.id)||""),d)):e}))}))}else b((function(a){return a.map((function(a,r){var i,s,l;return r===t?(0,o.Z)((0,o.Z)({},a),{},{observacion:e,contrato_id:null===n||void 0===n?void 0:n.contrato_id,id:(null===n||void 0===n||null===(i=n.pagos)||void 0===i||null===(s=i.pagos)||void 0===s||null===(l=s.at(-1))||void 0===l?void 0:l.id)||""}):a}))}))}),$,(function(e){M(!0),k(e.observaciones)}));return(0,u.useEffect)((function(){var e=m.map((function(e){return{id:e.id,contrato_id:e.contrato_id,dni:e.dni,nombre:e.nombre+" - "+e.quincena,quincena:e.quincena}}));e.length>0&&U(e)}),[m]),(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(v.Z,{text:"Programaci\xf3n de pagos",ruta:"/planilla"}),(0,x.jsxs)("div",{className:"margenes",children:[(0,x.jsx)(j,{setModal:q,setFilterText:R}),(0,x.jsx)(h.Z,{columns:ee,table:G})]}),C&&(0,x.jsx)(V,{open:C,setModal:q,closeModal:function(){L(!1)},actualizarTabla:W,trabajadores:Q}),S&&(0,x.jsx)(Z.Z,{modal:S,setModal:M,observacion:F,boton:!1})]})}}}]);
//# sourceMappingURL=871.ffb19e52.chunk.js.map