"use strict";(self.webpackChunkrinconada=self.webpackChunkrinconada||[]).push([[71],{57294:function(e,n,t){t.r(n),t.d(n,{default:function(){return P}});var a=t(74165),r=t(15861),o=t(29439),i=t(72791),s=t(38411),c=t(53939),l=t(99763),d=t(83188),u=t(43513),f=t(80184),p=function(e){var n=e.columns,t=e.table;return(0,f.jsx)("div",{className:"table-container",children:(0,f.jsx)(u.ZP,{columns:n,data:t,pagination:!0,fixedHeader:!0,striped:!0,highlightOnHover:!0,expandableRows:!0,expandableRowsComponent:function(e){var n=e.data;return(0,f.jsx)("section",{style:{padding:"10px 20px 10px 20px"},children:(0,f.jsx)("div",{className:"row-container",children:(0,f.jsxs)("table",{children:[(0,f.jsxs)("tr",{children:[(0,f.jsx)("th",{children:"Producto"}),(0,f.jsx)("th",{children:"Cantidad"})]}),n.transferencia_productos.map((function(e){return(0,f.jsxs)("tr",{children:[(0,f.jsx)("td",{children:e.producto.nombre}),(0,f.jsx)("td",{children:e.cantidad})]})}))]})})})},expandableRowDisabled:function(e){var n;return 0===(null===e||void 0===e||null===(n=e.trabajador)||void 0===n?void 0:n.length)},paginationComponentOptions:{rowsPerPageText:"Filas por p\xe1gina",rangeSeparatorText:"de",selectAllRowsItem:!0,selectAllRowsItemText:"Todos"},responsive:!0,noHeader:!0,noDataComponent:"No se encontraron resultados."})})},h=t(87309),m=t(78820),v=function(e){var n=e.abrirModal,t=e.realizar;return(0,f.jsx)("div",{className:"buscador-transferencia",children:t?(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{children:(0,f.jsx)("label",{htmlFor:"",children:(0,f.jsx)("strong",{children:"Transferencias realizadas"})})}),(0,f.jsx)(h.ZP,{htmlType:"submit",icon:(0,f.jsx)(m.lFz,{}),onClick:function(){return n(!0)},children:"Realizar"})]}):(0,f.jsx)("div",{children:(0,f.jsx)("div",{children:(0,f.jsx)("label",{htmlFor:"",children:(0,f.jsx)("strong",{children:"Transferencias solicitadas"})})})})})},x=t(93433),g=t(1413),Z=t(4942),j=t(4808),b=t(69967),w=t(17615),_=t(68588),k=t(80458),C=function(e){var n=e.almacen_id,t=e.actualizarTabla,d=(e.id,e.data,w.Z.useForm()),u=(0,o.Z)(d,1)[0],p=(0,i.useContext)(s.s),v=p.getData,C=p.createData,N=(p.dataToEdit,p.setModal),S=p.modal,P=p.cargando,E=p.setCargando,T={almacen_id:n,origen:n,fecha:"",producto:"",destino:"",cantidad:"",estado_origen:"",estado_destino:""},y=(0,i.useState)([]),D=(0,o.Z)(y,2),F=D[0],I=D[1],M=(0,i.useState)([]),z=(0,o.Z)(M,2),R=z[0],A=z[1],O=(0,i.useState)([]),q=(0,o.Z)(O,2),L=q[0],H=q[1],Y=(0,i.useState)([]),G=(0,o.Z)(Y,2),V=(G[0],G[1]),U=(0,i.useState)([]),B=(0,o.Z)(U,2),J=B[0],K=B[1],Q=(0,i.useState)(T),W=(0,o.Z)(Q,2),X=W[0],$=W[1],ee=(0,i.useState)([]),ne=(0,o.Z)(ee,2),te=ne[0],ae=ne[1],re=(0,i.useState)(""),oe=(0,o.Z)(re,2),ie=oe[0],se=oe[1],ce=function(){var e=(0,r.Z)((0,a.Z)().mark((function e(){var t,r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v("almacen");case 2:return t=e.sent,e.next=5,v("producto");case 5:r=e.sent,I(t.data),A(r.data),H(r.data.filter((function(e){return e.almacen_id===n})));case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),le=function(){N(!1)};(0,i.useEffect)((function(){var e=R.filter((function(e){return X.origen==e.almacen_id})),n=F.filter((function(e){return parseInt(X.origen)!==e.id}));V(e),K(n)}),[X]);var de=function(e,n,t){if(!n&&e.target){var a=e.target,r=a.name,o=a.value;u.setFieldsValue((0,Z.Z)({},r,o)),$((function(e){return(0,g.Z)((0,g.Z)({},e),{},(0,Z.Z)({},r,o))}))}else u.setFieldsValue((0,Z.Z)({},n,e)),$((function(t){return(0,g.Z)((0,g.Z)({},t),{},(0,Z.Z)({},n,e))}));void 0!==t&&se(t)};(0,i.useEffect)((function(){ce()}),[]),(0,i.useEffect)((function(){var e,t;if(""!==X.producto&&""!==X.destino)if(e=R.filter((function(e){return e.id===X.producto})),t=R.filter((function(n){var t=e.find((function(e){return""!==e.codigo_interno&&e.codigo_interno===n.codigo_interno&&n.almacen_id===X.destino}));return t||""})),t.length>0){if(0===(null===te||void 0===te?void 0:te.filter((function(e){var n=t.find((function(n){return n.codigo_interno===e.codigo_interno}));return n?e:n}))).length){var a=t.map((function(t){var a,r,o,i,s,c,l,d;return{id:null===(a=e)||void 0===a||null===(r=a.at(-1))||void 0===r?void 0:r.id,fecha:X.fecha,almacen_id:n,almacen_origen:n,almacen_destino:X.destino,producto_id:X.producto,producto_origen:X.producto,producto_destino:t.id,nombre:null===(o=e)||void 0===o||null===(i=o.at(-1))||void 0===i?void 0:i.nombre,stock:null===(s=e)||void 0===s||null===(c=s.at(-1))||void 0===c?void 0:c.stock,stock_origen:null===(l=e)||void 0===l||null===(d=l.at(-1))||void 0===d?void 0:d.stock,stock_destino:t.stock,cantidad:""}})).filter((function(e){return e.stock>0}));a.length>0?ae((function(e){return[].concat((0,x.Z)(e),[a.at(-1)])})):((0,l.q)(500,"No se puede agregar el producto, producto sin stock ."),$((function(e){return(0,g.Z)((0,g.Z)({},e),{},{producto:""})})))}}else(0,l.q)(500,"Producto no registrado en almac\xe9n de destino."),$((function(e){return(0,g.Z)((0,g.Z)({},e),{},{producto:""})}))}),[X.producto,X.destino]),(0,i.useEffect)((function(){""!==ie&&0!==te.length&&void 0!==ie&&ae((function(e){return e.map((function(e,n){return n===ie?(0,g.Z)((0,g.Z)({},e),{},{cantidad:X.cantidad}):e}))}))}),[ie,X.cantidad]);var ue=function(){var e=(0,r.Z)((0,a.Z)().mark((function e(n){var r,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r="almacen/transferencia",n.preventDefault(),!(te.filter((function(e){return parseInt(e.cantidad)>parseInt(e.stock)})).length>0)){e.next=7;break}(0,l.q)(500,"No se puede realizar la transferencia, stock insuficiente en uno de los productos."),e.next=12;break;case 7:return E(!0),e.next=10,C(te,r);case 10:(o=e.sent)&&((0,l.q)(o.status,o.msg),t(),le(),E(!1));case 12:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),fe=(0,c.vv)(de,(function(e){ae((function(n){return n.filter((function(n){return n.id!==e.id}))}))}),X.cantidad);return(0,f.jsxs)(b.Z,{className:"modal-transferencia",title:"Realizar transferencia",open:S,width:800,closeModal:le,children:[(0,f.jsxs)(w.Z,{form:u,className:"modal-body",onFinish:ue,layout:"horizontal",children:[(0,f.jsx)(w.Z.Item,{name:"fecha",children:(0,f.jsx)(_.Z,{defaultValue:X.fecha,style:{width:"100%"},format:"YYYY-MM-DD",name:"fecha",placeholder:"Fecha",onChange:function(e){return de(e,"fecha")}})}),(0,f.jsx)(w.Z.Item,{name:"destino",rules:[{required:!0,message:"Campo obligatorio!"}],children:(0,f.jsx)(k.Z,{showSearch:!0,placeholder:"Almac\xe9n destino",name:"destino",value:X.destino,optionFilterProp:"children",onChange:function(e){return de(e,"destino")},filterOption:function(e,n){var t;return(null!==(t=null===n||void 0===n?void 0:n.label)&&void 0!==t?t:"").toLowerCase().includes(e.toLowerCase())},options:J.map((function(e){return{label:e.nombre,value:e.id}}))})}),(0,f.jsx)(w.Z.Item,{name:"producto",children:(0,f.jsx)(k.Z,{showSearch:!0,placeholder:"Seleccione un producto",name:"producto",value:X.producto,optionFilterProp:"children",onChange:function(e){return de(e,"producto")},filterOption:function(e,n){var t;return(null!==(t=null===n||void 0===n?void 0:n.label)&&void 0!==t?t:"").toLowerCase().includes(e.toLowerCase())},options:null===L||void 0===L?void 0:L.map((function(e){return{label:e.nombre,value:e.id}}))})})]}),(0,f.jsx)("div",{className:"tabla-container",children:(0,f.jsx)(j.Z,{columns:fe,table:te})}),0!==te.length?(0,f.jsx)("div",{className:"button-transferir",children:(0,f.jsx)(h.ZP,{onClick:ue,icon:(0,f.jsx)(m.lFz,{}),loading:!!P,children:"Transferir"})}):""]})},N=t(49389),S=t(34664),P=(t(76487),N.Z.Search,function(){var e=(0,i.useContext)(s.s),n=e.getData,t=e.setData,u=e.data,h=e.setModal,m=e.modal,x=e.updateData,g=e.createData,Z=e.deleteData,j=(e.loading,(0,i.useState)([])),b=(0,o.Z)(j,2),w=b[0],_=b[1],N=(0,i.useState)(""),P=(0,o.Z)(N,2),E=P[0],T=P[1],y=(0,i.useState)([]),D=(0,o.Z)(y,2),F=D[0],I=D[1],M=function(){var e=(0,r.Z)((0,a.Z)().mark((function e(){var t;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"almacen",e.next=3,n("almacen");case 3:t=e.sent,_(t.data);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),z=function(){var e=(0,r.Z)((0,a.Z)().mark((function e(){var r,o,i,s;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="transferencia/realizada/".concat(E),o="transferencia/recibida/".concat(E),e.next=4,n(r);case 4:return i=e.sent,e.next=7,n(o);case 7:s=e.sent,t(i.data),I(s.data);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,i.useEffect)((function(){M()}),[]),(0,i.useEffect)((function(){""!==E&&z()}),[E]);var R=function(){var e=(0,r.Z)((0,a.Z)().mark((function e(n,t){var r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"transferencia",e.next=3,x(t,t.id,"transferencia");case 3:200===(r=e.sent).status&&((0,l.q)(r.status,r.msg),z());case 5:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}(),A=function(){var e=(0,r.Z)((0,a.Z)().mark((function e(n){var t;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"transferencia",e.next=3,Z("transferencia",n.id);case 3:200===(t=e.sent).status&&((0,l.q)(t.status,t.msg),z());case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),O=function(){var e=(0,r.Z)((0,a.Z)().mark((function e(n){var t,r,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="transferencia/retornar/".concat(n.id),r={transferencia_id:n.id,productos:n.transferencia_productos.map((function(e){return{id:e.producto.id,cantidad:e.cantidad,stock:e.producto.stock}}))},e.next=4,g(r,t);case 4:(o=e.sent)&&((0,l.q)(o.status,o.msg),z());case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),q=(0,c.Cl)(O,A),L=(0,c.H0)(R);return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(d.Z,{text:"Transferencias",user:"Usuario",ruta:"/logistica"}),(0,f.jsxs)("div",{className:"transferencia-layout",children:[(0,f.jsxs)("div",{children:[(0,f.jsxs)("div",{className:"almacen",children:[(0,f.jsxs)("label",{htmlFor:"",children:[(0,f.jsx)("strong",{children:"Seleccione un almac\xe9n:"})," "]}),(0,f.jsx)(k.Z,{placeholder:"Almac\xe9n",name:"almacen_id",onChange:function(e){return T(e)},style:{width:"200px"},options:w.map((function(e,n){return{label:e.nombre,value:e.id}}))})]}),""!==E?(0,f.jsxs)("div",{className:"margenes",children:[(0,f.jsx)(v,{abrirModal:h,realizar:!0}),u.length>0?(0,f.jsx)(p,{columns:q,table:u}):(0,f.jsx)("div",{className:"noData",children:(0,f.jsx)(S.Z,{image:S.Z.PRESENTED_IMAGE_SIMPLE,description:(0,f.jsx)("span",{children:"No hay registros para mostrar."})})})]}):""]}),""!==E?(0,f.jsxs)("div",{children:[(0,f.jsx)("br",{}),(0,f.jsx)("br",{}),(0,f.jsx)("br",{}),(0,f.jsx)("br",{}),(0,f.jsxs)("div",{className:"margenes",children:[(0,f.jsx)(v,{abrirModal:h,realizar:!1}),F.length>0?(0,f.jsx)(p,{columns:L,table:F}):(0,f.jsx)("div",{className:"noData",children:(0,f.jsx)(S.Z,{image:S.Z.PRESENTED_IMAGE_SIMPLE,description:(0,f.jsx)("span",{children:"No hay registros para mostrar."})})})]})]}):""]}),m&&(0,f.jsx)(C,{almacen_id:E,actualizarTabla:z})]})})},69967:function(e,n,t){t(72791);var a=t(49998),r=t(80184);n.Z=function(e){var n=e.className,t=e.title,o=e.open,i=e.width,s=e.closeModal,c=e.children;return(0,r.jsx)(a.Z,{destroyOnClose:!0,className:n,title:t,open:o,centered:!0,onCancel:s,footer:null,width:i,children:c})}},4808:function(e,n,t){t(72791);var a=t(43513),r=t(34664),o=(t(51279),t(80184));n.Z=function(e){var n=e.columns,t=e.table,i=e.filas,s=i?[i,2*i,3*i,4*i,5*i]:[10,20,30,40,50];return(0,o.jsx)("div",{className:"table-container",children:(0,o.jsx)(a.ZP,{columns:n,data:t,pagination:!0,striped:!0,highlightOnHover:!0,responsive:!0,paginationComponentOptions:{rowsPerPageText:"Filas por p\xe1gina",rangeSeparatorText:"de",selectAllRowsItem:!1,selectAllRowsItemText:"Todos",preserveSelectedOnPageChange:!0},paginationPerPage:i||10,paginationRowsPerPageOptions:s,noDataComponent:(0,o.jsx)(r.Z,{image:r.Z.PRESENTED_IMAGE_SIMPLE,description:(0,o.jsx)("span",{children:"No hay registros para mostrar."})})})})}}}]);
//# sourceMappingURL=71.aecf0570.chunk.js.map