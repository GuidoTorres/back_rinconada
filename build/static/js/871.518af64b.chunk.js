"use strict";(self.webpackChunkrinconada=self.webpackChunkrinconada||[]).push([[871],{42871:function(e,t,n){n.r(t),n.d(t,{default:function(){return O}});var a=n(4942),r=n(74165),i=n(1413),o=n(15861),s=n(29439),l=n(97892),c=n.n(l),u=n(72791),d=n(38411),f=(n(71368),n(53939)),p=n(99763),h=(n(64941),n(83188)),v=n(4808),Z=n(87309),m=n(49389),x=n(80184),g=m.Z.Search,j=function(e){var t=e.setFilterText,n=e.setModal;return(0,x.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,x.jsx)("div",{style:{width:"300px"},children:(0,x.jsx)(g,{placeholder:"Ingresa un termino aqui...",onChange:function(e){return t(e.target.value)}})}),(0,x.jsx)("div",{children:(0,x.jsx)(Z.ZP,{onClick:function(){n(!0)},style:{width:"150px"},children:"Pago Multiple"})})]})},b=n(93433),w=n(17615),y=n(53655),_=n(77128),C=n(83099),q=n(80458),T=n(58848),S=n(68588),D=n(36473),M=n(78792),Y=n(66106),F=n(30914),k=n(2964),E=n(35790),I=n(16026),L=n(69967),P=n(78820);var z=function(e){var t=e.open,n=e.setModal,l=e.trabajadores,f=e.actualizarTabla,h=e.closeModalSubmit,v=void 0===h?function(){}:h,g=e.dataToEdit,j=e.setDataToEdit,z=void 0===j?function(){}:j,O=w.Z.useForm(),V=(0,s.Z)(O,1)[0],N=y.Z.Text,A=(0,u.useContext)(d.s),R=A.updateData,J=A.createData,K=A.cargando,X=A.setCargando,B=null===l||void 0===l?void 0:l.map((function(e){return{value:e.id,label:e.nombre}})),G=function(){n(!1)},H=(0,u.useState)([]),Q=(0,s.Z)(H,2),U=Q[0],W=Q[1],$=(0,u.useState)([]),ee=(0,s.Z)($,2),te=ee[0],ne=ee[1];(0,u.useEffect)((function(){if(U.length>0){var e=l.filter((function(e){return U.includes(e.id)}));ne(e)}}),[U]);var ae=(0,u.useState)(I.XK),re=(0,s.Z)(ae,2),ie=re[0],oe=re[1],se=function(e,t){if(!t&&e.target){var n=e.target,r=n.name,o=n.value;V.setFieldsValue((0,a.Z)({},r,o)),oe((function(e){return(0,i.Z)((0,i.Z)({},e),{},(0,a.Z)({},r,o))}))}else V.setFieldsValue((0,a.Z)({},t,e)),oe((function(n){return(0,i.Z)((0,i.Z)({},n),{},(0,a.Z)({},t,e))}))},le=(0,u.useState)([]),ce=(0,s.Z)(le,2),ue=ce[0],de=ce[1];(0,u.useEffect)((function(){if(te.length>0){var e=te.map((function(e){return{id:e.id,nombre:e.nombre,contrato_id:e.contrato_id,teletrans:e.teletrans||"",trabajador_dni:e.dni}}));de(g?ie.trabajadores.map((function(e){return(0,i.Z)((0,i.Z)({},e),{},{teletrans:parseFloat(e.teletrans)})})):e)}}),[te]);var fe=function(){var e=0;return ue.forEach((function(t){e=parseFloat(e)+parseFloat(t.teletrans)})),e},pe=function(){var e=(0,o.Z)((0,r.Z)().mark((function e(){var t,n,a,i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t="pago/programacion/multiple",X(!0),n={observacion:ie.observacion,fecha_pago:c()(ie.fecha_pago).format("YYYY-MM-DD")||"",teletrans:fe(),tipo:"pago",trabajadores:ue.map((function(e){return{contrato_id:e.contrato_id,volquetes:e.voqluetes,teletrans:e.teletrans,quincena:e.quincena,trabajador_dni:e.trabajador_dni}}))},!g){e.next=10;break}return e.next=6,R(n,ie.pago_id,"pago/multiple");case 6:(a=e.sent)&&((0,p.q)(a.status,a.msg),f(),he()),e.next=14;break;case 10:return e.next=12,J(n,t);case 12:(i=e.sent)&&((0,p.q)(i.status,i.msg),f(),he());case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,u.useEffect)((function(){g&&(oe((0,i.Z)((0,i.Z)({},g),{},{fecha_pago:c()(g.fecha_pago).format("YYYY-MM-DD")})),W(g.trabajadores.map((function(e){return e.id}))),de(g.trabajadores))}),[g]);var he=function(){z(null),G(),v()};return(0,x.jsx)(L.Z,{open:t,closeModal:g?he:G,title:"Juntar Teletrans",width:800,children:(0,x.jsxs)(w.Z,{form:V,className:"modal-body",onFinish:pe,layout:"vertical",children:[(0,x.jsx)(_.Z,{orientation:"left",children:"Datos"}),(0,x.jsxs)(C.Z,{direction:"vertical",style:{width:"100%"},children:[(0,x.jsx)(w.Z.Item,{label:"Seleccione trabajadores",children:(0,x.jsx)(q.Z,{showSearch:!0,mode:"multiple",placeholder:"Seleccione trabajadores",style:{width:"100%"},allowClear:!0,value:U,onChange:function(e){W(e)},options:B,disabled:!!g,filterOption:function(e,t){return t.label.toLowerCase().indexOf(e.toLowerCase())>=0}})}),(0,x.jsx)(w.Z.Item,{label:"Observaci\xf3n",children:(0,x.jsx)(m.Z,{name:"observacion",value:ie.observacion,placeholder:"Observaci\xf3n",onChange:function(e){return se(e)}})}),(0,x.jsx)(w.Z.Item,{label:"Fecha",children:(0,x.jsx)(T.ZP,{locale:E.Z,children:(0,x.jsx)(S.Z,{allowClear:!1,value:c()(ie.fecha_pago),name:"fecha_pago",placeholder:"Fecha de Pago",picker:"day",onChange:function(e){return se(e,"fecha_pago")},style:{width:"100%"},format:"YYYY-MM-DD"})})})]}),(0,x.jsx)(_.Z,{orientation:"left",children:"Trabajadores"}),(0,x.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:4},children:(0,x.jsxs)(D.Z,{style:{width:"100%"},children:[(0,x.jsx)(M.ZP,{itemLayout:"horizontal",dataSource:ue,renderItem:function(e){return(0,x.jsx)(M.ZP.Item,{children:(0,x.jsxs)(Y.Z,{style:{width:"100%"},children:[(0,x.jsx)(F.Z,{span:18,children:(0,x.jsx)(C.Z,{direction:"vertical",children:e.nombre})}),(0,x.jsx)(F.Z,{span:6,children:(0,x.jsx)(C.Z,{direction:"vertical",children:(0,x.jsx)(m.Z,{value:e.teletrans,placeholder:"Teletrans",type:"number",min:0,onChange:function(t){return function(e,t){var n=ue.findIndex((function(e){return e.id===t}));ue[n]=(0,i.Z)((0,i.Z)({},ue[n]),{},{teletrans:parseFloat(e.target.value)}),de((0,b.Z)(ue))}(t,e.id)},required:!0})})})]},e.id)})}}),(0,x.jsxs)(C.Z,{direction:"horizontal",style:{width:"100%",justifyContent:"end",alignItems:"center",padding:24},children:[(0,x.jsx)(N,{type:fe()%4===0?"success":"danger",children:"TOTAL DE TELETRANS"}),(0,x.jsx)(k.Z,{message:fe(),type:fe()%4===0?"success":"error"})]})]})}),(0,x.jsxs)(C.Z,{direction:"horizontal",style:{width:"100%",marginTop:20,justifyContent:"end"},children:[(0,x.jsx)(Z.ZP,{onClick:G,children:"Cancelar"}),(0,x.jsx)(Z.ZP,{type:"primary",htmlType:"submit",icon:(0,x.jsx)(P.lFz,{}),loading:!!K,disabled:0===ue.length,children:"Registrar"})]})]})})},O=function(){var e=(0,u.useContext)(d.s),t=e.getData,n=e.createData,l=(0,u.useState)([]),Z=(0,s.Z)(l,2),m=Z[0],g=Z[1],b=(0,u.useState)(!1),w=(0,s.Z)(b,2),y=w[0],_=w[1],C=(0,u.useState)(!1),q=(0,s.Z)(C,2),T=(q[0],q[1]),S=(0,u.useState)([]),D=(0,s.Z)(S,2),M=(D[0],D[1],(0,u.useState)("")),Y=(0,s.Z)(M,2),F=Y[0],k=Y[1],E=(0,u.useState)([]),I=(0,s.Z)(E,2),L=I[0],P=I[1],O=(0,u.useState)([]),V=(0,s.Z)(O,2),N=V[0],A=V[1],R=function(){var e=(0,o.Z)((0,r.Z)().mark((function e(){var n,a,o;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t("programacion");case 2:(n=e.sent)&&(a=n.data.filter((function(e){return null!==e})),g(a),o=a.map((function(e){return(0,i.Z)((0,i.Z)({},e),{},{initialTeletrans:e.teletrans,initialVolquetes:e.volquetes,fecha_pago:c()(new Date).format("YYYY-MM-DD")})})),g(o));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,u.useEffect)((function(){R()}),[]);var J=function(){var e=(0,o.Z)((0,r.Z)().mark((function e(t){var a,i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={observacion:t.observacion,fecha_pago:t.fecha_pago,volquetes:t.initialVolquetes,teletrans:t.initialTeletrans,tipo:"pago",trabajadores:[{volquetes:t.initialVolquetes,teletrans:t.initialTeletrans,contrato_id:t.contrato_id,trabajador_dni:t.dni,quincena:t.quincena}]},e.next=3,n(a,"pago/programacion/multiple");case 3:(i=e.sent)&&((0,p.q)(i.status,i.msg),R());case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();(0,u.useEffect)((function(){var e=m&&m.filter((function(e){var t,n,a,r;return(null===e||void 0===e||null===(t=e.nombre)||void 0===t||null===(n=t.toLowerCase())||void 0===n?void 0:n.includes(F.toLowerCase()))||(null===e||void 0===e||null===(a=e.cargo)||void 0===a||null===(r=a.toLowerCase())||void 0===r?void 0:r.includes(F.toLowerCase()))}));P(e)}),[F,m]);var K=(0,f.lF)((function(e,t,n){var r=e.target,o=r.name,s=r.value;g((function(e){return e.map((function(e,r){var l,c,u,d;return r===n?(0,i.Z)((0,i.Z)({},e),{},(d={},(0,a.Z)(d,o,s),(0,a.Z)(d,"contrato_id",null===t||void 0===t?void 0:t.contrato_id),(0,a.Z)(d,"id",(null===t||void 0===t||null===(l=t.pagos)||void 0===l||null===(c=l.pagos)||void 0===c||null===(u=c.at(-1))||void 0===u?void 0:u.id)||""),d)):e}))}))}),J);return(0,u.useEffect)((function(){var e=m.map((function(e){return{id:e.id,contrato_id:e.contrato_id,dni:e.dni,nombre:e.nombre+" - "+e.quincena,quincena:e.quincena}}));e.length>0&&A(e)}),[m]),(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(h.Z,{text:"Programaci\xf3n de pagos",ruta:"/planilla"}),(0,x.jsxs)("div",{className:"margenes",children:[(0,x.jsx)(j,{setModal:_,setFilterText:k}),(0,x.jsx)(v.Z,{columns:K,table:L})]}),y&&(0,x.jsx)(z,{open:y,setModal:_,closeModal:function(){T(!1)},actualizarTabla:R,trabajadores:N})]})}}}]);
//# sourceMappingURL=871.518af64b.chunk.js.map